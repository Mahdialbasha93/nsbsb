name: Discord Server Cloner

on:
  workflow_dispatch:
    inputs:
      run_duration:
        description: 'Run duration (hours)'
        required: false
        default: '6'
        type: string

jobs:
  run-bot:
    runs-on: ubuntu-latest
    timeout-minutes: 360
    
    steps:
    - name: üöÄ Checkout code
      uses: actions/checkout@v3
    
    - name: üì¶ Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        cache: 'npm'
    
    - name: üì• Install dependencies
      run: |
        echo "Installing dependencies..."
        npm install discord.js-selfbot-v13@1.3.0 dotenv@16.0.3 --no-audit --no-fund --legacy-peer-deps
        echo "‚úÖ Dependencies installed"
    
    - name: üèÉ Run Server Cloner
      env:
        TOKEN: ${{ secrets.DISCORD_TOKEN }}
        ALLOWED_USER_IDS: ${{ secrets.ALLOWED_USER_IDS }}
      run: |
        echo "=========================================="
        echo "ü§ñ DISCORD SERVER CLONER"
        echo "=========================================="
        echo ""
        echo "üìã Configuration:"
        echo "‚Ä¢ Node.js: $(node --version)"
        echo "‚Ä¢ Auto-reconnect: Enabled"
        echo "‚Ä¢ Max reconnects: 3"
        echo "‚Ä¢ Slow threshold: 30 seconds"
        echo ""
        echo "üìù Commands:"
        echo "!clone - Start cloning process"
        echo "!help - Show help"
        echo "!status - Check bot status"
        echo "!servers - List servers"
        echo "cancel - Cancel operation"
        echo ""
        echo "‚ö° Auto-Reconnect Features:"
        echo "‚Ä¢ Detects slow operations"
        echo "‚Ä¢ Reconnects automatically"
        echo "‚Ä¢ Resumes cloning"
        echo ""
        echo "=========================================="
        echo ""
        
        # Run the bot
        timeout 6h node index.js || true
        
        echo ""
        echo "=========================================="
        echo "üõë Bot stopped"
        echo "=========================================="
